<!doctype html>
<html
        xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout" xmlns="http://www.w3.org/1999/html"
        layout:decorate="~{layout/default_layout}" lang="ko">

<div layout:fragment="content">
    <style>
        .selected-locations {
            list-style: none;
            padding: 0;
        }

        .selected-locations li {
            display: inline-block;
            margin-right: 10px;
            background-color: #ddd;
            padding: 5px;
            border-radius: 5px;
            cursor: pointer;
        }
    </style>
    <script src="//t1.daumcdn.net/mapjsapi/bundle/postcode/prod/postcode.v2.js"></script>
    <script>
        var selectedLocations = new Set();

        function addLocation() {
            var inputElement = document.getElementById('addressSet');
            var locationValue = inputElement.value.trim();

            if (locationValue !== '') {
                // ìƒˆë¡œìš´ ì§€ì—­ì„ ì¶”ê°€
                var selectedLocationsElement = document.getElementById('selectedLocations');
                var liElement = document.createElement('li');
                liElement.textContent = locationValue;
                liElement.setAttribute('onclick', 'removeLocation(this)');
                selectedLocationsElement.appendChild(liElement);

                selectedLocations.add(locationValue);
                // ì…ë ¥ í•„ë“œ ì´ˆê¸°í™”
                inputElement.value = '';

                updateHiddenInput();
            }
        }

        function removeLocation(element) {
            // ì„ íƒëœ ì§€ì—­ì„ ì œê±°
            var selectedLocationsElement = document.getElementById('selectedLocations');
            selectedLocationsElement.removeChild(element);

            var locationValue = element.textContent;
            selectedLocations.delete(locationValue);

            updateHiddenInput();
        }

        function updateHiddenInput() {
            var locationsArray = Array.from(selectedLocations);
            var hiddenInput = document.getElementById('selectedLocationsInput');
            hiddenInput.value = locationsArray.join(','); // ë°°ì—´ì„ ì‰¼í‘œë¡œ êµ¬ë¶„ëœ ë¬¸ìì—´ë¡œ ë³€í™˜
        }

        document.addEventListener("DOMContentLoaded", function () {
            // í˜ì´ì§€ ë¡œë”© ì‹œ ì´ˆê¸° ìƒíƒœ ì„¤ì •
            initializePage();
        });

        function initializePage() {
            var posts = document.querySelectorAll('[id^="postPage"]');

            posts.forEach(function (post, index) {
                if (index === 0) {
                    var page = document.getElementById("page" + index);
                    // ì´ˆê¸°ì—ëŠ” ì²« ë²ˆì§¸ postë§Œ ë³´ì´ë„ë¡ ì„¤ì •
                    post.style.display = 'flex';
                    console.log(page);
                    page.classList.add("active");
                } else {
                    // ë‚˜ë¨¸ì§€ postëŠ” ìˆ¨ê¹€
                    post.style.display = 'none';
                }
            });
        }

        function showOnlySelected(selectedIndex) {
            var posts = document.querySelectorAll('[id^="postPage"]');
            posts.forEach(function (post) {
                var index = parseInt(post.id.replace('postPage', ''), 10);
                var page = document.getElementById("page" + index);
                if (index === selectedIndex) {

                    page.classList.add("active");
                    post.style.display = 'flex';
                } else {
                    page.classList.remove("active");
                    post.style.display = 'none';
                }
            });
        }

        /* ì£¼ì†Œ ë³€ê²½í•˜ê¸° */
        /* ì£¼ì†Œ API */
        window.onload = function () {
            document.getElementById("addressInputBtn").addEventListener("click", function () {
                new daum.Postcode({
                    oncomplete: function (data) {
                        var address = '';

                        address = data.sido + ' ' + data.sigungu; // ì‹œ/ë„ì™€ ì‹œ/êµ°/êµ¬ë¥¼ ì¡°í•©í•˜ì—¬ addressì— ì €ì¥

                        // ìš°í¸ë²ˆí˜¸, ì£¼ì†Œ ì •ë³´ë¥¼ í•´ë‹¹ í•„ë“œì— ë„£ëŠ”ë‹¤.
                        document.getElementById('addressSet').value = data.zonecode;
                        document.getElementById("addressSet").value = address;
                    }
                }).open();
            });
        }

    </script>

    <main>
        <header class="site-header d-flex flex-column justify-content-center align-items-center">
        </header>

        <section class="trending-podcast-section mb-0" id="section_2">
            <div class="container">

                <div class="row justify-content-center">
                    <!-- ë²„íŠ¼ ì¶”ê°€í•˜ê¸° -->
                    <button class="custom-border-option-btn col-5 mx-auto my-2" type="button" data-bs-toggle="collapse" data-bs-target="#cardSection" aria-expanded="false" aria-controls="cardSection">
                        ì¡°ê±´ê²€ìƒ‰ ğŸ”
                    </button>
                    <div class="custom-card-border bg-outline-light text-dark collapse" id="cardSection">
                        <form action="/v1/search/posts/1" method="get" class="post-form" role="form">
                            <div class="card-body">

                                <div class="col-12 mt-2 mx-auto">
                                    <div class="mb-1 col-12">
                                        <label for="jobId">ì§ë¬´</label>
                                    </div>
                                    <div class="card row my-1 p-3">
                                        <div class="row">
                                            <div th:each="job, jobStat : ${jobs}" class="form-check col-md-3 col-6 ">
                                                <input class="form-check-input" type="checkbox" th:id="'job' + ${jobStat.index}" name="jobIdSet"
                                                       th:value="${job.id}"/>
                                                <label class="form-check-label" th:for="'job' + ${jobStat.index}" th:text="${job.name}">ì§ë¬´ëª…</label>
                                            </div>
                                        </div>
                                    </div>
                                </div>


                                <div class="col-12 mt-4 mx-auto">
                                    <div class="mb-1 col-12">
                                        <label for="stackId">ìš”êµ¬ìŠ¤íƒ</label>
                                    </div>
                                    <div class="card row my-1 p-3">
                                        <div class="row">
                                            <div th:each="stack, stackStat : ${stacks}" class="form-check col-md-2 col-6">
                                                <input class="form-check-input" type="checkbox" th:id="'stack' + ${stackStat.index}" name="stackIdSet"
                                                       th:value="${stack.id}"/>
                                                <label class="form-check-label" th:for="'stack' + ${stackStat.index}" th:text="${stack.name}">ìŠ¤íƒëª…</label>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div class="col-12 mt-4">
                                    <div class="col-12">
                                        <div class="row align-items-center">
                                            <div class="col-md-6 col-12">
                                                <div class="mb-1">
                                                    <label for="addressSet">ì§€ì—­</label>
                                                </div>
                                                <div class="input-group input-group-lg">
                                                    <button type="button" id="addressInputBtn">ì£¼ì†Œ ì°¾ê¸°</button>
                                                    <input class="form-control" type="text" id="addressSet" placeholder="ê²€ìƒ‰ëœ ì§€ì—­" disabled/>
                                                    <button type="button" onclick="addLocation()">ì¶”ê°€</button>
                                                </div>
                                            </div>
                                            <div class="col-md-4 col-12 justify-content-end">
                                                <div class="my-1">
                                                    <label for="career">ê²½ë ¥</label>
                                                </div>
                                                <input class="form-control-lg" type="number" id="career" name="career" placeholder="ê²½ë ¥(ë…„) ì´ìƒ"/>
                                            </div>
                                            <div class="col-md-2 col-12 mx-auto">
                                                <label for="includeEnded">ë§ˆê° í¬í•¨ ì—¬ë¶€</label>
                                                <input class="form-check-input" type="checkbox" id="includeEnded" name="includeEnded"/>
                                            </div>
                                        </div>
                                    </div>

                                    <ul id="selectedLocations" class="selected-locations">
                                        <!-- ì„ íƒëœ ì§€ì—­ì„ ì—¬ê¸°ì— í‘œì‹œí•  ì˜ˆì • -->
                                    </ul>
                                </div>


                                <div class="col-6 pt-4 mb-3 m-auto">
                                    <input type="hidden" id="selectedLocationsInput" name="addressSet" value="">
                                    <button type="submit" class="form-control">ê²€ìƒ‰í•˜ê¸°</button>
                                </div>


                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </section>

        <section class="trending-podcast-section pt-5">
            <div class="container">
                <div class="col-lg-12 col-12">
                    <div class="section-title-wrap mb-3">
                        <h4 class="section-title">ê²€ìƒ‰ ê²°ê³¼</h4>
                    </div>
                </div>

                <div class="col-lg-12 col-12 mb-4 mb-lg-0" th:if="${#lists.size(postPage) == 0 or postPage==null}">
                    <h1>ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.</h1>
                </div>

                <div class="row mx-auto" th:each="postList, postListStat : ${postPage}"
                     th:id="'postPage'+${postListStat.index}">


                    <div class="col-lg-4 col-12 my-4 mb-lg-0" th:each="post, postStat : ${postList}">
                        <div class="custom-block custom-block-full mb-2" >
                            <div class="custom-block-image-wrap">
                                <a th:href="@{/v1/click/post/{postId}/detail(companyId=${post.companyId}, postId=${post.id}, postType=${post.postType})}">
                                    <img src="/images/podcast/27670664_7369753.jpg" class="custom-block-image img-fluid"
                                         alt="">
                                </a>
                            </div>

                            <div class="custom-block-info">
                                <div class="d-flex justify-content-between">
                                    <div class="mb-2 d-inline-flex" th:if="${post.postType=='NORMAL'}">
                                        <span class="badge bg-dark" th:text="ì¼ë°˜ê³µê³ "></span>
                                        <span class="badge bg-danger" th:text="ë§ˆê°" th:if="${post.closed==true}"></span>
                                    </div>
                                    <div class="mb-2 d-inline-flex" th:if="${post.postType=='MZ'}">
                                        <span class="badge bg-primary" th:text="MZê³µê³ "></span>
                                        <span class="badge bg-danger" th:text="ë§ˆê°" th:if="${post.closed==true}"></span>
                                    </div>
                                    <a class="text-black " th:text="${post.name}">
                                    </a>
                                </div>
                                <a class="bi-pin-map me-1">
                                <span class="text-black" th:text="${post.workAddress}"></span>
                                </a>
                                <a class="d-flex justify-content-between me-1 my-2">
                                    <span class="bi-clock-fill text-black" th:text="' ë§ˆê°ì¼: ~'+${post.endDate}"></span>
                                </a>

                                <hr>
                                <h6 class="my-1" th:text="${post.title}"></h6>

                                <div class="custom-block-bottom d-flex justify-content-between mt-2">
                                    <a class="bi-person me-1">
                                        <span class="text-black" th:text="'ê²½ë ¥ '+${post.career}+'ë…„'"></span>
                                    </a>

                                    <span th:text="${post.job}"></span>

                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <section class="trending-podcast-section pt-5">
            <div class="col-lg-4 col-12 mx-auto">
                <nav aria-label="Page navigation example">
                    <ul class="pagination pagination-lg justify-content-center mt-5">
                        <li class="page-item" th:if="${strNum>=5}">
                            <!--/v1/search/posts/1-->
                            <a class="page-link" th:href="@{/v1/search/posts/{strNum}(strNum=${strNum}-5, stackIdSet=${dto.stackIdSet}, career=${dto.career}, jobIdSet=${dto.jobIdSet}, addressSet=${dto.addressSet}, includeEnded=${dto.includeEnded})}ÂºÂª"
                               aria-label="Previous">
                                <span aria-hidden="true">&laquo;</span>
                            </a>
                        </li>
                        <div th:each="post, postStat:${postPage}">
                            <li class="page-item" th:id="'page'+${postStat.index}"><a class="page-link"
                                                                                      th:onclick="showOnlySelected([[${postStat.index}]])"
                                                                                      th:text="${postStat.index+strNum}"></a>
                            </li>
                        </div>
                        <li class="page-item" th:if="${#lists.size(postPage)>=5 and #lists.size(postPage[4])==9}">
                            <a class="page-link" th:href="@{/v1/search/posts/{strNum}(strNum=${strNum}+5, stackIdSet=${dto.stackIdSet}, career=${dto.career}, jobIdSet=${dto.jobIdSet}, addressSet=${dto.addressSet}, includeEnded=${dto.includeEnded})}"
                               aria-label="Next">
                                <span aria-hidden="true">&raquo;</span>
                            </a>
                        </li>
                    </ul>
                </nav>
            </div>
        </section>

    </main>
</div>

</html>